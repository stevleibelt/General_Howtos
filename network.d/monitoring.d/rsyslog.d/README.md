# Rsyslog

## Sections

* [setup](setup.md) - Contains example configurations

## The syslog message format RFC3164

The message consits of  3 parts: `PRI`, `HEADER (TIMESTAMP, HOSTNAME)`, `MSG (TAG, CONTENT)`.
As an example: `<34>Oct 06 22:14:15 mymachine su: 'su root' failed for bumshuettel on /dev/pts/8`.

* `PRI`: Priority of the log record (facility level * 8 - servity level)
* `HEADER`:
  * `TIMESTAMP`: In local time without the year, millisecond or timezone in format `Mmm dd hh:mm:ss`
  * `HOSTNAME`: hostname, IPv4 or IPv6
* `MSG`:
  * `TAG`: Or named `su`, the name of the program or process that generates the message. The delimiter of `:` is not standarized, it could als be a space or square brackets with a PID
  * `CONTENT`: Message log

## The syslog message format RFC5424

The message consists of 3 parts: `Header (PRI, VERSION, TIMESTAMP, HOSTNAME, APP-NAME, PROCID, MSGID)`, `STRUCTURED DATA (SD-ELEMENTS (SD-ID, SD-PARAM))`, `MSG`.
As an example: `<34>1 2003-10-11T22:14:15.003Z mymachine.example.com su - ID47 - BOM'su root' failed for lonvick on /dev/pts/8`.

* `HEADER`:
  * `PRI`: Priority of the log record (facility level * 8 - servity level)
  * `VERSION`: 1 and maybe an increased number in the future
  * `TIMESTAMP`: `2003-10-11T22:14:15.003Z`
  * `HOSTNAME`: FQDN-Hostname or IP address or NILVALUE
  * `APP-NAME`: Name or NILVALUE
  * `PROCID`: PID or NILVALUE
  * `MSGID`: String or NILVALUE
* `STRUCTURED DATA`: String with key-value pairs or NILVALUE (e.g.: 'foo="bar"')
* `MSG`: String representation of the Log-Message (`BOM`->UTF-8, else ASCII)

## Syslog log levels

| Code | Log level | Key word |
| --- | --- | --- |
| 0 | Emergency | emerg |
| 1 | Alert | alert |
| 2 | Critical | crit |
| 3 | Error | err |
| 4 | Warning | warning |
| 5 | Notice | notice |
| 6 | Informational | info |
| 7 | Debug | debug |

## Syslog facilities

Only the codes are defined in the syslog protocol.

| Code | Keyword | Description |
| --- | --- | --- |
| 0 | kern | Kernel messages |
| 1 | user | General user-level messages. This facility is typically used by default if no other is specified |
| 2 | mail | Mail system messages. Generated by running mail servers and clients if any. |
| 3 | daemon | System daemon message not related to kernel but to other background services |
| 4 | auth | General security/authentication messages (generated by tools like su, login, ftpd etc. that ask for user credentials) |
| 5 | syslog | Messages generated by the syslog daemon itself |
| 6 | lpr | Messages of line printer subsystem generated by printing services |
| 7 | news | Network news subsystem messages (can be used when network devices generate syslog messages) |
| 8 | uucp | UUCP (Unix-to-Unix Copy Protocol) subsystem messages |
| 9 | cron | Cron daemon messages related to the scheduled tasks (errors, scheduled tasks results etc) |
| 10 | authpriv | Private security/authentication messages. The messages with this level are routed to a separate file with more restricted permissions |
| 11 | ftp | File Transfer Protocol subsystem messages |
| 12 | ntp | Network Time Protocol subsystem messages |
| 13 | security/log audit | Messages generated by auditing (sub)systems. Facility is also used by various security/authorization tools |
| 14 | console/log alert | Alert messages that require special attention; generated by alerting systems. Can also be used by various security/authorization tools or other any applications that need to relay an important alert message |
| 15 | solaris-cron/clock | Messages to clock daemon like cron. Pretty much the same as facility 9. The difference is historic rather than functional. |
| 16-22 | local0-local7 | Local0-local7: Local facilities reserved for custom use by processes that do not fit into the categories defined above |

## Test

```
#following message should occure in
#   journal -xfn
#   in your database
logger -p local0.warn mytestmessage
```

## Automatically cleanup syslog table

Use the [rsyslog mysql housekeeping](https://github.com/bazzline/rsyslog_mysql_housekeeping) script.

# Links

* [rsyslog documentation - official V8](https://www.rsyslog.com/doc/v8-stable/) - 20210419
    * [ommysql: MySQL Database Output Module](https://www.rsyslog.com/doc/v8-stable/configuration/modules/ommysql.html) - 20210420
    * [Understanding Rsyslog Queues](https://www.rsyslog.com/doc/v8-stable/concepts/queues.html) - 20210420
    * [General Queue Parameters](https://www.rsyslog.com/doc/v8-stable/rainerscript/queue_parameters.html) - 20210420
* [The Syslog Handbook â€“ How to Collect and Redirect Logs to a Remote Server: freecodecamp.org](https://www.freecodecamp.org/news/what-is-syslog-handbook/) - 20240301
